<?xml version="1.0" encoding="UTF-8" ?>

<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
   
      <title>okmanideep.github.io/</title>
   
   <link>https://okmanideep.github.io</link>
   <description>Android Â· Development Â· Design</description>
   <language>en-uk</language>
   <managingEditor> Manideep Polireddi</managingEditor>
   <atom:link href="rss" rel="self" type="application/rss+xml" />
   
	<item>
	  <title>Understanding Composition and Side Effects</title>
	  <link>/understanding-composition-and-side-effects</link>
	  <author>Manideep Polireddi</author>
	  <pubDate>2022-04-01T23:30:00+05:30</pubDate>
	  <guid>/understanding-composition-and-side-effects</guid>
	  <description><![CDATA[
	     <style>
.insight {
    background: #3B4354;
    border-radius: 3px;
    padding: 12px;
}
.insight > :first-child {
    margin-top: 0;
}
.insight > :last-child {
    margin-bottom: 0;
}
</style>

<p>With compose, we write a lot of functions and lambdas in our code. It is essential to know the order of execution of these functions, if and when are they executed.</p>

<p>Let&#39;s dive in. </p>

<p>We are going to use the following <code>Composable</code> to find out the order of execution and understand in what order our code executes during runtime.</p>

<h2>ğŸ›  Setup</h2>
<div class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span></span><a id="line-1" name="line-1"></a><span class="nd">@Composable</span>
<a id="line-2" name="line-2"></a><span class="kd">private</span> <span class="kd">fun</span> <span class="nf">TrafficLight</span><span class="p">(</span>
<a id="line-3" name="line-3"></a>    <span class="n">lightEmoji</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span>
<a id="line-4" name="line-4"></a>    <span class="n">modifier</span><span class="p">:</span> <span class="n">Modifier</span> <span class="o">=</span> <span class="n">Modifier</span>
<a id="line-5" name="line-5"></a><span class="p">)</span> <span class="p">{</span>
<a id="line-6" name="line-6"></a>    <span class="n">log</span><span class="p">(</span><span class="s">&quot;</span><span class="si">$</span><span class="n">lightEmoji</span><span class="s"> Composition 1&quot;</span><span class="p">)</span>
<a id="line-7" name="line-7"></a>    <span class="n">LaunchedEffect</span><span class="p">(</span><span class="n">lightEmoji</span><span class="p">)</span> <span class="p">{</span>
<a id="line-8" name="line-8"></a>        <span class="n">log</span><span class="p">(</span><span class="s">&quot;</span><span class="si">$</span><span class="n">lightEmoji</span><span class="s"> LaunchedEffect 1&quot;</span><span class="p">)</span>
<a id="line-9" name="line-9"></a>    <span class="p">}</span>
<a id="line-10" name="line-10"></a>    <span class="n">SideEffect</span> <span class="p">{</span>
<a id="line-11" name="line-11"></a>        <span class="n">log</span><span class="p">(</span><span class="s">&quot;</span><span class="si">$</span><span class="n">lightEmoji</span><span class="s"> SideEffect 1&quot;</span><span class="p">)</span>
<a id="line-12" name="line-12"></a>    <span class="p">}</span>
<a id="line-13" name="line-13"></a>    <span class="n">DisposableEffect</span><span class="p">(</span><span class="n">lightEmoji</span><span class="p">)</span> <span class="p">{</span>
<a id="line-14" name="line-14"></a>        <span class="n">log</span><span class="p">(</span><span class="s">&quot;</span><span class="si">$</span><span class="n">lightEmoji</span><span class="s"> DisposableEffect 1&quot;</span><span class="p">)</span>
<a id="line-15" name="line-15"></a>
<a id="line-16" name="line-16"></a>        <span class="n">onDispose</span> <span class="p">{</span>
<a id="line-17" name="line-17"></a>            <span class="n">log</span><span class="p">(</span><span class="s">&quot;</span><span class="si">$</span><span class="n">lightEmoji</span><span class="s"> onDispose 1&quot;</span><span class="p">)</span>
<a id="line-18" name="line-18"></a>        <span class="p">}</span>
<a id="line-19" name="line-19"></a>    <span class="p">}</span>
<a id="line-20" name="line-20"></a>
<a id="line-21" name="line-21"></a>    <span class="n">Text</span><span class="p">(</span><span class="n">lightEmoji</span><span class="p">,</span> <span class="n">fontSize</span> <span class="o">=</span> <span class="m">120.</span><span class="n">sp</span><span class="p">,</span> <span class="n">modifier</span> <span class="o">=</span> <span class="n">modifier</span><span class="p">)</span>
<a id="line-22" name="line-22"></a>
<a id="line-23" name="line-23"></a>    <span class="n">log</span><span class="p">(</span><span class="s">&quot;</span><span class="si">$</span><span class="n">lightEmoji</span><span class="s"> Composition 2&quot;</span><span class="p">)</span>
<a id="line-24" name="line-24"></a>    <span class="n">LaunchedEffect</span><span class="p">(</span><span class="n">lightEmoji</span><span class="p">)</span> <span class="p">{</span>
<a id="line-25" name="line-25"></a>        <span class="n">log</span><span class="p">(</span><span class="s">&quot;</span><span class="si">$</span><span class="n">lightEmoji</span><span class="s"> LaunchedEffect 2&quot;</span><span class="p">)</span>
<a id="line-26" name="line-26"></a>    <span class="p">}</span>
<a id="line-27" name="line-27"></a>    <span class="n">SideEffect</span> <span class="p">{</span>
<a id="line-28" name="line-28"></a>        <span class="n">log</span><span class="p">(</span><span class="s">&quot;</span><span class="si">$</span><span class="n">lightEmoji</span><span class="s"> SideEffect 2&quot;</span><span class="p">)</span>
<a id="line-29" name="line-29"></a>    <span class="p">}</span>
<a id="line-30" name="line-30"></a>    <span class="n">DisposableEffect</span><span class="p">(</span><span class="n">lightEmoji</span><span class="p">)</span> <span class="p">{</span>
<a id="line-31" name="line-31"></a>        <span class="n">log</span><span class="p">(</span><span class="s">&quot;</span><span class="si">$</span><span class="n">lightEmoji</span><span class="s"> DisposableEffect 2&quot;</span><span class="p">)</span>
<a id="line-32" name="line-32"></a>
<a id="line-33" name="line-33"></a>        <span class="n">onDispose</span> <span class="p">{</span>
<a id="line-34" name="line-34"></a>            <span class="n">log</span><span class="p">(</span><span class="s">&quot;</span><span class="si">$</span><span class="n">lightEmoji</span><span class="s"> onDispose 2&quot;</span><span class="p">)</span>
<a id="line-35" name="line-35"></a>        <span class="p">}</span>
<a id="line-36" name="line-36"></a>    <span class="p">}</span>
<a id="line-37" name="line-37"></a><span class="p">}</span>
</code></pre></div>
<p>Just a bunch of logs around a <code>Text</code></p>

<h2>Touch And Go</h2>

<p>We are going to start by adding and removing this <code>TrafficLight</code> on touch as shown below</p>
<div class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span></span><a id="line-1" name="line-1"></a><span class="nd">@Composable</span>
<a id="line-2" name="line-2"></a><span class="kd">fun</span> <span class="nf">TouchAndGo</span><span class="p">()</span> <span class="p">{</span>
<a id="line-3" name="line-3"></a>    <span class="kd">var</span> <span class="nv">isVisible</span> <span class="k">by</span> <span class="n">remember</span> <span class="p">{</span> <span class="n">mutableStateOf</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span> <span class="p">}</span>
<a id="line-4" name="line-4"></a>    <span class="n">Box</span><span class="p">(</span>
<a id="line-5" name="line-5"></a>        <span class="n">contentAlignment</span> <span class="o">=</span> <span class="n">Alignment</span><span class="p">.</span><span class="na">Center</span><span class="p">,</span>
<a id="line-6" name="line-6"></a>        <span class="n">modifier</span> <span class="o">=</span> <span class="n">Modifier</span>
<a id="line-7" name="line-7"></a>            <span class="p">.</span><span class="na">fillMaxSize</span><span class="p">()</span>
<a id="line-8" name="line-8"></a>            <span class="p">.</span><span class="na">clickable</span> <span class="p">{</span>
<a id="line-9" name="line-9"></a>                <span class="n">log</span><span class="p">(</span><span class="s">&quot;---Click---------------------&quot;</span><span class="p">)</span>
<a id="line-10" name="line-10"></a>                <span class="n">isVisible</span> <span class="o">=</span> <span class="o">!</span><span class="n">isVisible</span>
<a id="line-11" name="line-11"></a>            <span class="p">},</span>
<a id="line-12" name="line-12"></a>    <span class="p">)</span> <span class="p">{</span>
<a id="line-13" name="line-13"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">isVisible</span><span class="p">)</span> <span class="p">{</span>
<a id="line-14" name="line-14"></a>            <span class="n">TrafficLight</span><span class="p">(</span><span class="n">lightEmoji</span> <span class="o">=</span> <span class="s">&quot;ğŸŸ¢&quot;</span><span class="p">)</span>
<a id="line-15" name="line-15"></a>        <span class="p">}</span>
<a id="line-16" name="line-16"></a>    <span class="p">}</span>
<a id="line-17" name="line-17"></a><span class="p">}</span>
</code></pre></div>
<p>Initially we show nothing. On click, we show the green light ğŸŸ¢.</p>

<video width="320" height="320" autoplay muted loop>
  <source src="https://i.imgur.com/TCy72F9.mp4" type="video/mp4">
</video>

<p>So these are the logs</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span><a id="line-1" name="line-1"></a>---Click---------------------
<a id="line-2" name="line-2"></a>ğŸŸ¢ Composition - 1
<a id="line-3" name="line-3"></a>ğŸŸ¢ Composition - 2
<a id="line-4" name="line-4"></a>ğŸŸ¢ DisposableEffect - 1
<a id="line-5" name="line-5"></a>ğŸŸ¢ DisposableEffect - 2
<a id="line-6" name="line-6"></a>ğŸŸ¢ SideEffect - 1
<a id="line-7" name="line-7"></a>ğŸŸ¢ SideEffect - 2
<a id="line-8" name="line-8"></a>ğŸŸ¢ LaunchedEffect - 1
<a id="line-9" name="line-9"></a>ğŸŸ¢ LaunchedEffect - 2
<a id="line-10" name="line-10"></a>---Click---------------------
<a id="line-11" name="line-11"></a>ğŸŸ¢ onDispose - 2
<a id="line-12" name="line-12"></a>ğŸŸ¢ onDispose - 1
</code></pre></div>
<div class="insight">
<h3>âœ¨ Insights</h3>

<p>When a <code>Composable</code> is added to the UI:</p>

<ul>
<li>Composition (our <code>@Composable</code> function) runs first</li>
<li>Then all the <code>DisposableEffect</code>s in the order present in the code</li>
<li>Then all the <code>SideEffect</code>s in the order present in the code</li>
<li>and then all the <code>LaunchedEffect</code>s in the order present in the code</li>
</ul>

<p>When a <code>Composable</code> is removed from the UI:</p>

<ul>
<li>All the <code>onDispose</code>s run in <strong>reverse order</strong> as present in the code</li>
</ul>
</div>

<h3>ğŸ’¡ Tip!</h3>

<p>Arrange your code to reflect the order of execution. Keep all the effects at the end of the function in the order of <code>DisposableEffect</code>, <code>SideEffect</code> and <code>LaunchedEffect</code>. It helps discover some code smells by making them slightly more apparent.</p>
<div class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span></span><a id="line-1" name="line-1"></a><span class="nd">@Composable</span>
<a id="line-2" name="line-2"></a><span class="kd">fun</span> <span class="nf">MyComponent</span><span class="p">(</span><span class="cm">/*...*/</span><span class="p">)</span> <span class="p">{</span>
<a id="line-3" name="line-3"></a>    <span class="c1">// Describe the UI</span>
<a id="line-4" name="line-4"></a>
<a id="line-5" name="line-5"></a>    <span class="n">DisposableEffect</span><span class="p">(</span><span class="cm">/*...*/</span><span class="p">)</span> <span class="p">{</span>
<a id="line-6" name="line-6"></a>        <span class="c1">// acquire resource / attach</span>
<a id="line-7" name="line-7"></a>
<a id="line-8" name="line-8"></a>        <span class="n">onDispose</span> <span class="p">{</span>
<a id="line-9" name="line-9"></a>            <span class="c1">// release resource / detach</span>
<a id="line-10" name="line-10"></a>        <span class="p">}</span>
<a id="line-11" name="line-11"></a>    <span class="p">}</span>
<a id="line-12" name="line-12"></a>    <span class="n">SideEffect</span> <span class="p">{</span>
<a id="line-13" name="line-13"></a>        <span class="c1">// ...</span>
<a id="line-14" name="line-14"></a>    <span class="p">}</span>
<a id="line-15" name="line-15"></a>    <span class="n">LaunchedEffect</span><span class="p">(</span><span class="cm">/*...*/</span><span class="p">)</span> <span class="p">{</span>
<a id="line-16" name="line-16"></a>        <span class="c1">// ...</span>
<a id="line-17" name="line-17"></a>    <span class="p">}</span>
<a id="line-18" name="line-18"></a><span class="p">}</span>
</code></pre></div>
<hr>

<h2>Stop And Go</h2>

<p>Toggle between ğŸŸ¢ and ğŸ”´ on click</p>
<div class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span></span><a id="line-1" name="line-1"></a><span class="nd">@Composable</span>
<a id="line-2" name="line-2"></a><span class="kd">fun</span> <span class="nf">StopAndGo</span><span class="p">()</span> <span class="p">{</span>
<a id="line-3" name="line-3"></a>    <span class="kd">var</span> <span class="nv">go</span> <span class="k">by</span> <span class="n">remember</span> <span class="p">{</span> <span class="n">mutableStateOf</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">}</span>
<a id="line-4" name="line-4"></a>
<a id="line-5" name="line-5"></a>    <span class="n">Box</span><span class="p">(</span>
<a id="line-6" name="line-6"></a>        <span class="n">contentAlignment</span> <span class="o">=</span> <span class="n">Alignment</span><span class="p">.</span><span class="na">Center</span><span class="p">,</span>
<a id="line-7" name="line-7"></a>        <span class="n">modifier</span> <span class="o">=</span> <span class="n">Modifier</span>
<a id="line-8" name="line-8"></a>            <span class="p">.</span><span class="na">fillMaxSize</span><span class="p">()</span>
<a id="line-9" name="line-9"></a>            <span class="p">.</span><span class="na">clickable</span> <span class="p">{</span>
<a id="line-10" name="line-10"></a>                <span class="n">log</span><span class="p">(</span><span class="s">&quot;---Click---------------------&quot;</span><span class="p">)</span>
<a id="line-11" name="line-11"></a>                <span class="n">go</span> <span class="o">=</span> <span class="o">!</span><span class="n">go</span>
<a id="line-12" name="line-12"></a>            <span class="p">},</span>
<a id="line-13" name="line-13"></a>    <span class="p">)</span> <span class="p">{</span>
<a id="line-14" name="line-14"></a>        <span class="kd">val</span> <span class="nv">light</span> <span class="o">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">go</span><span class="p">)</span> <span class="s">&quot;ğŸŸ¢&quot;</span> <span class="k">else</span> <span class="s">&quot;ğŸ”´&quot;</span>
<a id="line-15" name="line-15"></a>        <span class="n">TrafficLight</span><span class="p">(</span><span class="n">lightEmoji</span> <span class="o">=</span> <span class="n">light</span><span class="p">)</span>
<a id="line-16" name="line-16"></a>    <span class="p">}</span>
<a id="line-17" name="line-17"></a><span class="p">}</span>
</code></pre></div>
<video width="320" height="320" autoplay muted loop>
  <source src="https://i.imgur.com/pJWzmgh.mp4" type="video/mp4">
</video>

<p>Let&#39;s look at the logs. For brevity, we removed multiple logs for Composition and Effects</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span><a id="line-1" name="line-1"></a>ğŸŸ¢ Composition
<a id="line-2" name="line-2"></a>ğŸŸ¢ DisposableEffect
<a id="line-3" name="line-3"></a>ğŸŸ¢ SideEffect
<a id="line-4" name="line-4"></a>ğŸŸ¢ LaunchedEffect
<a id="line-5" name="line-5"></a>---Click---------------------
<a id="line-6" name="line-6"></a>ğŸ”´ Composition
<a id="line-7" name="line-7"></a>ğŸŸ¢ onDispose
<a id="line-8" name="line-8"></a>ğŸ”´ DisposableEffect
<a id="line-9" name="line-9"></a>ğŸ”´ SideEffect
<a id="line-10" name="line-10"></a>ğŸ”´ LaunchedEffect
</code></pre></div>
<p>One might have expected this, but it is an important aspect to keep in mind.</p>

<div class="insight">
<h3>âœ¨ Insights</h3>
<ul>
<li>Composition of the <i>incoming composable</i>* runs before the <i>outgoing composable</i>* disposes (<code>onDispose</code>)</li>
<li><code>DisposableEffect</code> of the <i>incoming composable</i>* runs after the <i>outgoing composable</i>* disposes (<code>onDispose</code>)</li>
</ul>

</div>

<blockquote>
<p>*There is no notion of incoming and outgoing composable <em>objects</em> at runtime in the above example. I have chosen to word it that way since we are accustomed to object oriented thinking. Essentially at runtime, compose notices a <code>State</code> change, re-runs the corresponding code that is accessing the state. The re-run is what informs the runtime of which <code>DisposableEffect</code>s to dispose. We will come back to this notion of objects at runtime later</p>
</blockquote>

<h2>Stop Fade Go</h2>

<p>More often than not, we animate our changes. Let&#39;s look at the order of execution when we add animation to the above example</p>
<div class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span></span><span class="nd">@Composable</span>
<span class="kd">fun</span> <span class="nf">StopFadeGo</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">go</span> <span class="k">by</span> <span class="n">remember</span> <span class="p">{</span> <span class="n">mutableStateOf</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">}</span>

    <span class="n">Box</span><span class="p">(</span>
        <span class="n">contentAlignment</span> <span class="o">=</span> <span class="n">Alignment</span><span class="p">.</span><span class="na">Center</span><span class="p">,</span>
        <span class="n">modifier</span> <span class="o">=</span> <span class="n">Modifier</span>
            <span class="p">.</span><span class="na">fillMaxSize</span><span class="p">()</span>
            <span class="p">.</span><span class="na">clickable</span> <span class="p">{</span>
                <span class="n">log</span><span class="p">(</span><span class="s">&quot;---Click---------------------&quot;</span><span class="p">)</span>
                <span class="n">go</span> <span class="o">=</span> <span class="o">!</span><span class="n">go</span>
            <span class="p">},</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="nv">light</span> <span class="o">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">go</span><span class="p">)</span> <span class="s">&quot;ğŸŸ¢&quot;</span> <span class="k">else</span> <span class="s">&quot;ğŸ”´&quot;</span>
<span class="hll">        <span class="n">Crossfade</span><span class="p">(</span><span class="n">targetState</span> <span class="o">=</span> <span class="n">light</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">            <span class="n">TrafficLight</span><span class="p">(</span><span class="n">lightEmoji</span> <span class="o">=</span> <span class="nb">it</span><span class="p">)</span>
</span><span class="hll">        <span class="p">}</span>
</span>    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text"><span></span><a id="line-1" name="line-1"></a>ğŸŸ¢ Composition
<a id="line-2" name="line-2"></a>ğŸŸ¢ DisposableEffect
<a id="line-3" name="line-3"></a>ğŸŸ¢ SideEffect
<a id="line-4" name="line-4"></a>ğŸŸ¢ LaunchedEffect
<a id="line-5" name="line-5"></a>---Click---------------------
<a id="line-6" name="line-6"></a>ğŸ”´ Composition
<a id="line-7" name="line-7"></a>ğŸ”´ DisposableEffect
<a id="line-8" name="line-8"></a>ğŸ”´ SideEffect
<a id="line-9" name="line-9"></a>ğŸ”´ LaunchedEffect
<a id="line-10" name="line-10"></a>ğŸŸ¢ onDispose
</code></pre></div>
<div class="insight">
<h3>âœ¨ Insights</h3>

<p>When animated, the outgoing composable is disposed only after the animation is complete</p>
</div>

<p>Might feel obvious in hindsight. But it is important to keep in mind that since the <code>DisposableEffect</code> of the incoming composable runs before the <code>onDispose</code> of the outgoing composable, if they are trying to attach to the same instance or acquire the same resource, it might create issues.</p>

<hr>

<h2>Ready Set Go</h2>

<p>ğŸ”´ Ready -&gt; ğŸ”´ Set -&gt; ğŸŸ¢ Go on click</p>
<div class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span></span><a id="line-1" name="line-1"></a><span class="nd">@Composable</span>
<a id="line-2" name="line-2"></a><span class="kd">fun</span> <span class="nf">ReadySetGo</span><span class="p">()</span> <span class="p">{</span>
<a id="line-3" name="line-3"></a>    <span class="kd">var</span> <span class="nv">count</span> <span class="k">by</span> <span class="n">remember</span> <span class="p">{</span> <span class="n">mutableStateOf</span><span class="p">(</span><span class="m">1</span><span class="p">)</span> <span class="p">}</span>
<a id="line-4" name="line-4"></a>
<a id="line-5" name="line-5"></a>    <span class="n">Box</span><span class="p">(</span>
<a id="line-6" name="line-6"></a>        <span class="n">contentAlignment</span> <span class="o">=</span> <span class="n">Alignment</span><span class="p">.</span><span class="na">Center</span><span class="p">,</span>
<a id="line-7" name="line-7"></a>        <span class="n">modifier</span> <span class="o">=</span> <span class="n">Modifier</span>
<a id="line-8" name="line-8"></a>            <span class="p">.</span><span class="na">fillMaxSize</span><span class="p">()</span>
<a id="line-9" name="line-9"></a>            <span class="p">.</span><span class="na">clickable</span> <span class="p">{</span>
<a id="line-10" name="line-10"></a>                <span class="n">log</span><span class="p">(</span><span class="s">&quot;---Click---------------------&quot;</span><span class="p">)</span>
<a id="line-11" name="line-11"></a>                <span class="n">count</span><span class="o">++</span>
<a id="line-12" name="line-12"></a>            <span class="p">},</span>
<a id="line-13" name="line-13"></a>    <span class="p">)</span> <span class="p">{</span>
<a id="line-14" name="line-14"></a>        <span class="kd">val</span> <span class="nv">step</span> <span class="o">=</span> <span class="n">count</span> <span class="o">%</span> <span class="m">3</span>
<a id="line-15" name="line-15"></a>        <span class="kd">val</span> <span class="nv">light</span> <span class="o">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">step</span> <span class="o">==</span> <span class="m">0</span><span class="p">)</span> <span class="s">&quot;ğŸŸ¢&quot;</span> <span class="k">else</span> <span class="s">&quot;ğŸ”´&quot;</span>
<a id="line-16" name="line-16"></a>        <span class="kd">val</span> <span class="nv">message</span> <span class="o">=</span> <span class="k">when</span> <span class="p">(</span><span class="n">step</span><span class="p">)</span> <span class="p">{</span>
<a id="line-17" name="line-17"></a>            <span class="m">1</span> <span class="o">-&gt;</span> <span class="s">&quot;Ready&quot;</span>
<a id="line-18" name="line-18"></a>            <span class="m">2</span> <span class="o">-&gt;</span> <span class="s">&quot;Set&quot;</span>
<a id="line-19" name="line-19"></a>            <span class="m">0</span> <span class="o">-&gt;</span> <span class="s">&quot;GO!&quot;</span>
<a id="line-20" name="line-20"></a>            <span class="k">else</span> <span class="o">-&gt;</span> <span class="s">&quot;Uh Oh!&quot;</span>
<a id="line-21" name="line-21"></a>        <span class="p">}</span>
<a id="line-22" name="line-22"></a>        <span class="n">Column</span><span class="p">(</span><span class="n">horizontalAlignment</span> <span class="o">=</span> <span class="n">Alignment</span><span class="p">.</span><span class="na">CenterHorizontally</span><span class="p">)</span> <span class="p">{</span>
<a id="line-23" name="line-23"></a>            <span class="n">TrafficLight</span><span class="p">(</span><span class="n">lightEmoji</span> <span class="o">=</span> <span class="n">light</span><span class="p">)</span>
<a id="line-24" name="line-24"></a>            <span class="n">Spacer</span><span class="p">(</span><span class="n">modifier</span> <span class="o">=</span> <span class="n">Modifier</span><span class="p">.</span><span class="na">height</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">))</span>
<a id="line-25" name="line-25"></a>            <span class="n">Text</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">fontSize</span> <span class="o">=</span> <span class="m">36.</span><span class="n">sp</span><span class="p">)</span>
<a id="line-26" name="line-26"></a>        <span class="p">}</span>
<a id="line-27" name="line-27"></a>    <span class="p">}</span>
<a id="line-28" name="line-28"></a><span class="p">}</span>
</code></pre></div>
<video width="320" height="320" autoplay muted loop>
  <source src="https://i.imgur.com/dEqERF5.mp4" type="video/mp4">
</video>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span><a id="line-1" name="line-1"></a>ğŸ”´ Composition
<a id="line-2" name="line-2"></a>ğŸ”´ DisposableEffect
<a id="line-3" name="line-3"></a>ğŸ”´ SideEffect
<a id="line-4" name="line-4"></a>ğŸ”´ LaunchedEffect
<a id="line-5" name="line-5"></a>---Click---------------------
<a id="line-6" name="line-6"></a>---Click---------------------
<a id="line-7" name="line-7"></a>ğŸŸ¢ Composition
<a id="line-8" name="line-8"></a>ğŸ”´ onDispose
<a id="line-9" name="line-9"></a>ğŸŸ¢ DisposableEffect
<a id="line-10" name="line-10"></a>ğŸŸ¢ SideEffect
<a id="line-11" name="line-11"></a>ğŸŸ¢ LaunchedEffect
</code></pre></div>
<div class="insight">
<h3>âœ¨ Insights</h3>

<p>Composition and Effects are skipped when the inputs don't change!</p>
</div>

<p>Just like <a href="https://developer.android.com/jetpack/compose/lifecycle#skipping">the documentation says</a>. But what does &quot;inputs not changing&quot; really mean? Let&#39;s find out.</p>

<p>Instead of passing in a <code>String</code>, let&#39;s create our own <code>class</code></p>
<div class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span></span><span class="kd">private</span> <span class="kd">class</span> <span class="nc">Light</span><span class="p">(</span><span class="kd">val</span> <span class="nv">emoji</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span>
</code></pre></div>
<p>Update the <code>TrafficLight</code> and <code>ReadySetGo</code> to use <code>Light</code> instead of a <code>String</code></p>
<div class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span></span><span class="nd">@Composable</span>
<span class="kd">fun</span> <span class="nf">ReadySetGoClass</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">count</span> <span class="k">by</span> <span class="n">remember</span> <span class="p">{</span> <span class="n">mutableStateOf</span><span class="p">(</span><span class="m">1</span><span class="p">)</span> <span class="p">}</span>

    <span class="n">Box</span><span class="p">(</span>
        <span class="n">contentAlignment</span> <span class="o">=</span> <span class="n">Alignment</span><span class="p">.</span><span class="na">Center</span><span class="p">,</span>
        <span class="n">modifier</span> <span class="o">=</span> <span class="n">Modifier</span>
            <span class="p">.</span><span class="na">fillMaxSize</span><span class="p">()</span>
            <span class="p">.</span><span class="na">clickable</span> <span class="p">{</span>
                <span class="n">log</span><span class="p">(</span><span class="s">&quot;---Click---------------------&quot;</span><span class="p">)</span>
                <span class="n">count</span><span class="o">++</span>
            <span class="p">},</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="nv">step</span> <span class="o">=</span> <span class="n">count</span> <span class="o">%</span> <span class="m">3</span>
<span class="hll">        <span class="kd">val</span> <span class="nv">light</span> <span class="o">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">step</span> <span class="o">==</span> <span class="m">0</span><span class="p">)</span> <span class="n">Light</span><span class="p">(</span><span class="s">&quot;ğŸŸ¢&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">Light</span><span class="p">(</span><span class="s">&quot;ğŸ”´&quot;</span><span class="p">)</span>
</span>        <span class="kd">val</span> <span class="nv">message</span> <span class="o">=</span> <span class="k">when</span> <span class="p">(</span><span class="n">step</span><span class="p">)</span> <span class="p">{</span>
            <span class="m">1</span> <span class="o">-&gt;</span> <span class="s">&quot;Ready&quot;</span>
            <span class="m">2</span> <span class="o">-&gt;</span> <span class="s">&quot;Set&quot;</span>
            <span class="m">0</span> <span class="o">-&gt;</span> <span class="s">&quot;GO!&quot;</span>
            <span class="k">else</span> <span class="o">-&gt;</span> <span class="s">&quot;Uh Oh!&quot;</span>
        <span class="p">}</span>
        <span class="n">Column</span><span class="p">(</span><span class="n">horizontalAlignment</span> <span class="o">=</span> <span class="n">Alignment</span><span class="p">.</span><span class="na">CenterHorizontally</span><span class="p">)</span> <span class="p">{</span>
<span class="hll">            <span class="n">TrafficLight</span><span class="p">(</span><span class="n">light</span><span class="p">)</span>
</span>            <span class="n">Spacer</span><span class="p">(</span><span class="n">modifier</span> <span class="o">=</span> <span class="n">Modifier</span><span class="p">.</span><span class="na">height</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">))</span>
            <span class="n">Text</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">fontSize</span> <span class="o">=</span> <span class="m">36.</span><span class="n">sp</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nd">@Composable</span>
<span class="kd">private</span> <span class="kd">fun</span> <span class="nf">TrafficLight</span><span class="p">(</span>
<span class="hll">    <span class="n">light</span><span class="p">:</span> <span class="n">Light</span><span class="p">,</span>
</span>    <span class="n">modifier</span><span class="p">:</span> <span class="n">Modifier</span> <span class="o">=</span> <span class="n">Modifier</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="nv">lightEmoji</span> <span class="o">=</span> <span class="n">light</span><span class="p">.</span><span class="na">emoji</span>
    <span class="n">log</span><span class="p">(</span><span class="s">&quot;</span><span class="si">$</span><span class="n">lightEmoji</span><span class="s"> Composition&quot;</span><span class="p">)</span>

    <span class="n">Text</span><span class="p">(</span><span class="n">lightEmoji</span><span class="p">,</span> <span class="n">fontSize</span> <span class="o">=</span> <span class="m">120.</span><span class="n">sp</span><span class="p">,</span> <span class="n">modifier</span> <span class="o">=</span> <span class="n">modifier</span><span class="p">)</span>

<span class="hll">    <span class="n">DisposableEffect</span><span class="p">(</span><span class="n">light</span><span class="p">)</span> <span class="p">{</span>
</span>        <span class="n">log</span><span class="p">(</span><span class="s">&quot;</span><span class="si">$</span><span class="n">lightEmoji</span><span class="s"> DisposableEffect&quot;</span><span class="p">)</span>

        <span class="n">onDispose</span> <span class="p">{</span>
            <span class="n">log</span><span class="p">(</span><span class="s">&quot;</span><span class="si">$</span><span class="n">lightEmoji</span><span class="s"> onDispose&quot;</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">SideEffect</span> <span class="p">{</span>
        <span class="n">log</span><span class="p">(</span><span class="s">&quot;</span><span class="si">$</span><span class="n">lightEmoji</span><span class="s"> SideEffect&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="hll">    <span class="n">LaunchedEffect</span><span class="p">(</span><span class="n">light</span><span class="p">)</span> <span class="p">{</span>
</span>        <span class="n">log</span><span class="p">(</span><span class="s">&quot;</span><span class="si">$</span><span class="n">lightEmoji</span><span class="s"> LaunchedEffect&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Here are the logs after the change</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span><a id="line-1" name="line-1"></a>ğŸ”´ Composition
<a id="line-2" name="line-2"></a>ğŸ”´ DisposableEffect
<a id="line-3" name="line-3"></a>ğŸ”´ SideEffect
<a id="line-4" name="line-4"></a>ğŸ”´ LaunchedEffect
<a id="line-5" name="line-5"></a>---Click---------------------
<a id="line-6" name="line-6"></a>ğŸ”´ Composition
<a id="line-7" name="line-7"></a>ğŸ”´ onDispose
<a id="line-8" name="line-8"></a>ğŸ”´ DisposableEffect
<a id="line-9" name="line-9"></a>ğŸ”´ SideEffect
<a id="line-10" name="line-10"></a>ğŸ”´ LaunchedEffect
<a id="line-11" name="line-11"></a>---Click---------------------
<a id="line-12" name="line-12"></a>ğŸŸ¢ Composition
<a id="line-13" name="line-13"></a>ğŸ”´ onDispose
<a id="line-14" name="line-14"></a>ğŸŸ¢ DisposableEffect
<a id="line-15" name="line-15"></a>ğŸŸ¢ SideEffect
<a id="line-16" name="line-16"></a>ğŸŸ¢ LaunchedEffect
</code></pre></div>
<p>Well what happened there!</p>

<p>Our <code>Light</code> doesn&#39;t implement <code>.equals()</code>, the default implementation returns true only if they are the same instances. But we are creating a new instance every time. So compose runtime sees these as different inputs.</p>

<p>Let&#39;s add a log to equals</p>
<div class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span></span><span class="kd">private</span> <span class="kd">class</span> <span class="nc">Light</span><span class="p">(</span><span class="kd">val</span> <span class="nv">emoji</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">override</span> <span class="kd">fun</span> <span class="nf">equals</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="kt">Any?</span><span class="p">):</span> <span class="kt">Boolean</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">other</span> <span class="k">is</span> <span class="n">Light</span><span class="p">)</span> <span class="p">{</span>
<span class="hll">            <span class="kd">val</span> <span class="nv">result</span> <span class="o">=</span> <span class="k">super</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span class="hll">            <span class="n">log</span><span class="p">(</span><span class="s">&quot;</span><span class="si">$</span><span class="n">emoji</span><span class="s">.equals(</span><span class="si">${</span><span class="n">other</span><span class="p">.</span><span class="na">emoji</span><span class="si">}</span><span class="s">) = </span><span class="si">$</span><span class="n">result</span><span class="s">&quot;</span><span class="p">)</span>
</span>            <span class="k">return</span> <span class="n">result</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Haven&#39;t changed the implementation yet. Just added a log.</p>

<p>The same logs as above but with <code>equals()</code></p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span><a id="line-1" name="line-1"></a>ğŸ”´ Composition
<a id="line-2" name="line-2"></a>ğŸ”´ DisposableEffect
<a id="line-3" name="line-3"></a>ğŸ”´ SideEffect
<a id="line-4" name="line-4"></a>ğŸ”´ LaunchedEffect
<a id="line-5" name="line-5"></a>---Click---------------------
<a id="line-6" name="line-6"></a>ğŸ”´.equals(ğŸ”´) = false
<a id="line-7" name="line-7"></a>ğŸ”´ Composition
<a id="line-8" name="line-8"></a>ğŸ”´.equals(ğŸ”´) = false
<a id="line-9" name="line-9"></a>ğŸ”´.equals(ğŸ”´) = false
<a id="line-10" name="line-10"></a>ğŸ”´ onDispose
<a id="line-11" name="line-11"></a>ğŸ”´ DisposableEffect
<a id="line-12" name="line-12"></a>ğŸ”´ SideEffect
<a id="line-13" name="line-13"></a>ğŸ”´ LaunchedEffect
<a id="line-14" name="line-14"></a>---Click---------------------
<a id="line-15" name="line-15"></a>ğŸ”´.equals(ğŸŸ¢) = false
<a id="line-16" name="line-16"></a>ğŸŸ¢ Composition
<a id="line-17" name="line-17"></a>ğŸ”´.equals(ğŸŸ¢) = false
<a id="line-18" name="line-18"></a>ğŸ”´.equals(ğŸŸ¢) = false
<a id="line-19" name="line-19"></a>ğŸ”´ onDispose
<a id="line-20" name="line-20"></a>ğŸŸ¢ DisposableEffect
<a id="line-21" name="line-21"></a>ğŸŸ¢ SideEffect
<a id="line-22" name="line-22"></a>ğŸŸ¢ LaunchedEffect
</code></pre></div>
<p>So compose runtime compared the inputs. It observed that they are different (<code>.equals()</code> returned <code>false</code>), so ran the composable with the new input. It then compared the inputs again, to see if it has to run the <code>DisposableEffect</code> and the <code>LaunchedEffect</code> and ran them again because it received <code>false</code>.</p>

<p>Let&#39;s implement <code>equals()</code></p>
<div class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span></span><span class="kd">private</span> <span class="kd">class</span> <span class="nc">Light</span><span class="p">(</span><span class="kd">val</span> <span class="nv">emoji</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">override</span> <span class="kd">fun</span> <span class="nf">equals</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="kt">Any?</span><span class="p">):</span> <span class="kt">Boolean</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">other</span> <span class="k">is</span> <span class="n">Light</span><span class="p">)</span> <span class="p">{</span>
<span class="hll">            <span class="kd">val</span> <span class="nv">result</span> <span class="o">=</span> <span class="n">emoji</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="na">emoji</span>
</span>            <span class="n">log</span><span class="p">(</span><span class="s">&quot;</span><span class="si">$</span><span class="n">emoji</span><span class="s">.equals(</span><span class="si">${</span><span class="n">other</span><span class="p">.</span><span class="na">emoji</span><span class="si">}</span><span class="s">) = </span><span class="si">$</span><span class="n">result</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text"><span></span><a id="line-1" name="line-1"></a>ğŸ”´ Composition
<a id="line-2" name="line-2"></a>ğŸ”´ DisposableEffect
<a id="line-3" name="line-3"></a>ğŸ”´ SideEffect
<a id="line-4" name="line-4"></a>ğŸ”´ LaunchedEffect
<a id="line-5" name="line-5"></a>---Click---------------------
<a id="line-6" name="line-6"></a>ğŸ”´.equals(ğŸ”´) = true
<a id="line-7" name="line-7"></a>---Click---------------------
<a id="line-8" name="line-8"></a>ğŸ”´.equals(ğŸŸ¢) = false
<a id="line-9" name="line-9"></a>ğŸŸ¢ Composition
<a id="line-10" name="line-10"></a>ğŸ”´.equals(ğŸŸ¢) = false
<a id="line-11" name="line-11"></a>ğŸ”´.equals(ğŸŸ¢) = false
<a id="line-12" name="line-12"></a>ğŸ”´ onDispose
<a id="line-13" name="line-13"></a>ğŸŸ¢ DisposableEffect
<a id="line-14" name="line-14"></a>ğŸŸ¢ SideEffect
<a id="line-15" name="line-15"></a>ğŸŸ¢ LaunchedEffect
</code></pre></div>
<p>Back to normal.</p>

<p>Let&#39;s summarize all the insights</p>

<div class="insight">
<h3>âœ¨ Insights</h3>
<p>ğŸŸ© When a <code>Composable</code> is added to the UI:</p>

<ul>
<li>Composition (our <code>@Composable</code> function) runs first</li>
<li>Then all the <code>DisposableEffect</code>s in the order present in the code</li>
<li>Then all the <code>SideEffect</code>s in the order present in the code</li>
<li>and then all the <code>LaunchedEffect</code>s in the order present in the code</li>
</ul>

<p>ğŸ—‘ï¸  When a <code>Composable</code> is removed from the UI:</p>

<ul>
<li>All the <code>onDispose</code>s run in <strong>reverse order</strong> as present in the code</li>
</ul>

<p>ğŸ”€ When a composable is being replaced with another or recomposed with the new state:</p>
<ul>
<li>Composition of the <i>incoming composable</i>* runs before the <i>outgoing composable</i>* disposes (<code>onDispose</code>)</li>
<li><code>DisposableEffect</code> of the <i>incoming composable</i>* runs after the <i>outgoing composable</i>* disposes (<code>onDispose</code>)</li>
</ul>

<p>ğŸ’« When animated, the outgoing composable is disposed only after the animation is complete</p>

<p>ğŸš« Composition and Effects are skipped when the inputs don't change, according to <code>equals()</code></p>
</div>

	  ]]></description>
	</item>


</channel>
</rss>
