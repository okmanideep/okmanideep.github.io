<!DOCTYPE html>
<html>
<head>
    <!-- [[! Document Settings ]] -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- [[! Page Meta ]] -->
    <title>Improve your Android build times</title>
    <meta name="description" content="@okmanideep - Android 路 Development 路 Design" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" type="image/svg+xml" href="/assets/favicon-6e776a280d622eaae06cf84bba86ccae938052110ad2a9cdf38eff5ccee8b296.svg" >
    <link rel="shortcut icon" type="image/png" href="/assets/favicon-9d237f287925749d655560da077779bcddb8bc07cd0b419ae0844f7d9de94f7b.png" >

    <!-- [[! Styles'n'Scripts ]] -->
    <link type="text/css" rel="stylesheet" href="/assets/main-79e741cf9fb92bd8bad1ec9c23cb9ce2f68bd3b1b58056889f418dc699dc9453.css">
    <link href='https://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>

    <!-- [[! Ghost outputs important style and meta data with this tag ]] -->
        <link rel="canonical" href="" />
    <meta name="referrer" content="origin" />
    <link rel="next" href="page2/" />

    <meta property="og:site_name" content="@okmanideep" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Improve your Android build times" />
    <meta property="og:description" content="Simple things you can do to improve your gradle/android build time a lot" />
    <meta property="og:url" content="https://okmanideep.github.io/improve-android-build-times" />
    <meta property="og:image" content="https://okmanideep.github.io/assets/logo-black-on-white-square-20105d9e3b41defc83bbf981802e512e19a10853e8eeb5976222f9311ca6f8b8.jpg" />
    <meta property="og:locale" content="en_US" />
    <meta property="article:author" content="https://www.facebook.com/manideepiitb">

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Improve your Android build times" />
    <meta name="twitter:description" content="Simple things you can do to improve your gradle/android build time a lot" />
    <meta name="twitter:image" content="https://okmanideep.github.io/assets/logo-black-on-white-square-20105d9e3b41defc83bbf981802e512e19a10853e8eeb5976222f9311ca6f8b8.jpg" />
    <meta name="twitter:author" content="@okmanideep">

    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Website",
    "publisher": "Manideep Polireddi",
    "url": "https://okmanideep.github.io",
    "image": "/assets/logo-black-2e47e992b06507b3775750a2b8b939d6e1eecd27a8a1991865497c7e901ff8b5.png",
    "description": "Android 路 Development 路 Design"
}
    </script>

    <meta name="generator" content="Jekyll 3.0.0" />
    <link rel="alternate" type="application/rss+xml" title="@okmanideep" href="feed.xml" />


</head>
<body class="post-template nav-closed">

    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        <li class="nav-home " role="presentation"><a href="">Home</a></li>
        <!--<li class="nav-about " role="presentation"><a href="about.html">About</a></li>
        <li class="nav-fables " role="presentation"><a href="tag/fables/">Fables</a></li>
        <li class="nav-speeches " role="presentation"><a href="tag/speeches/">Speeches</a></li>
        <li class="nav-fiction " role="presentation"><a href="tag/fiction/">Fiction</a></li>-->
        <li class="nav-author " role="presentation"><a href="author/okmanideep/">Author</a></li>
    </ul>
    <a class="subscribe-button icon-feed" href="feed.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        <!-- [[! Everything else gets inserted here ]] -->
        <!-- < default -->

<!-- The comment above "< default" means - insert everything in this file into -->
    <!-- the [body] of the default.hbs template, which contains our header/footer. -->

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<header class="main-header post-head no-cover">
    <nav class="main-nav  clearfix">
        <a class="blog-logo" href="/"><img src="/assets/logo-white-75ce62a26171e897ee54c33128a1c7e591909134ef170d6c866e9ea84501473c.png" alt="Blog Logo"></a>
        <a class="subscribe-logo" href="feed.xml">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M25.57 176.1C12.41 175.4 .9117 185.2 .0523 198.4s9.173 24.65 22.39 25.5c120.1 7.875 225.7 112.7 233.6 233.6C256.9 470.3 267.4 480 279.1 480c.5313 0 1.062-.0313 1.594-.0625c13.22-.8438 23.25-12.28 22.39-25.5C294.6 310.3 169.7 185.4 25.57 176.1zM32 32C14.33 32 0 46.31 0 64s14.33 32 32 32c194.1 0 352 157.9 352 352c0 17.69 14.33 32 32 32s32-14.31 32-32C448 218.6 261.4 32 32 32zM63.1 351.9C28.63 351.9 0 380.6 0 416s28.63 64 63.1 64s64.08-28.62 64.08-64S99.37 351.9 63.1 351.9z"/></svg>
        </a>
    </nav>
</header>

<main class="content" role="main">

    <article class="post tag-android tag-gradle">

        <header class="post-header">
            <h1 class="post-title">Improve your Android build times</h1>
            <section class="post-meta">
            <!-- <a href=''>Manideep Polireddi</a> -->
            <time class="post-date" datetime="2016-04-06">06 Apr 2016</time>
                <!-- [[tags prefix=" on "]] -->
                 
                on 
                
                    
                       <a href='/tag/android'>Android</a>,
                       
                
                    
                       <a href='/tag/gradle'>Gradle</a>
                       
                
                
            </section>
        </header>

        <section class="post-content">
            <p>If you have the time to watch the video, go ahead. <a href="https://twitter.com/madisp">Madis Pink</a> goes over each optimisation you can do very carefully and how you can profile the gradle build process to identify the bottlenecks of your builds. If not, go ahead do the changes mentioned below, which will take less than two minutes and enjoy a much smaller build times.</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/AbNhen_zn-c" frameborder="0" allowfullscreen></iframe>

<h2>Optimisations</h2>

<h4>The minSdk 21 trick</h4>

<p>It doesn&#39;t matter your app is over the 65K method limit or not, enabling multiDex and having product flavors like this help a lot.  </p>
<div class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span></span><a id="line-1" name="line-1"></a><span class="n">productFlavors</span> <span class="o">{</span>
<a id="line-2" name="line-2"></a>    <span class="n">dev</span> <span class="o">{</span>
<a id="line-3" name="line-3"></a>        <span class="n">multiDexEnabled</span> <span class="kc">true</span>
<a id="line-4" name="line-4"></a>        <span class="n">minSdkVersion</span> <span class="mi">21</span>
<a id="line-5" name="line-5"></a>    <span class="o">}</span>
<a id="line-6" name="line-6"></a>    <span class="n">prod</span> <span class="o">{</span>
<a id="line-7" name="line-7"></a>        <span class="n">multiDexEnabled</span> <span class="kc">true</span>
<a id="line-8" name="line-8"></a>        <span class="n">minSdkVersion</span> <span class="mi">15</span>
<a id="line-9" name="line-9"></a>    <span class="o">}</span>
<a id="line-10" name="line-10"></a><span class="o">}</span>
</code></pre></div>
<p>And also keep in mind that <strong>Instant Run</strong> has <a href="https://twitter.com/tornorbye/status/717446584284241921">some overhead</a> on the dex method count in your debug builds, which might just make your method count go over the limit.</p>

<p>On my machine for my project 
<code>./gradlew :app:assembleProdDebug</code> takes <strong>55.623s</strong> and <code>./gradlew :app:assembleDevDebug</code> takes <strong>12.41s</strong>!</p>

<p>So yeah. Do it.</p>

<h4>Use a Daemon</h4>

<p>Using a daemon essentially means, gradle keeps a JVM and gradle instance running after the first build and reuses the same for subsequent builds. Android Studio <strong>already uses a daemon</strong> for every build that is triggered from the IDE, but this is very useful for builds triggered from the command line.</p>

<p><strong>Dry Run</strong> without daemon</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span><a id="line-1" name="line-1"></a>./gradlew :app:assembleDebug --dry-run
</code></pre></div>
<p>Output:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span><a id="line-1" name="line-1"></a>BUILD SUCCESSFUL
<a id="line-2" name="line-2"></a>
<a id="line-3" name="line-3"></a>Total time: 11.657 secs
<a id="line-4" name="line-4"></a>
<a id="line-5" name="line-5"></a>This build could be faster, please consider using the Gradle Daemon: https://docs.gradle.org/2.10/userguide/gradle_daemon.html
</code></pre></div>
<h4>Enabling gradle daemon</h4>

<p>In your <code>~/.gradle/gradle.properties</code></p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span><a id="line-1" name="line-1"></a>org.gradle.daemon=true
</code></pre></div>
<p><strong>Dry Run output after enabling daemon</strong></p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span><a id="line-1" name="line-1"></a>BUILD SUCCESSFUL
<a id="line-2" name="line-2"></a>
<a id="line-3" name="line-3"></a>Total time: 1.757 secs
</code></pre></div>
<h4>Upgradle your gradle version</h4>

<p>The gradle team is constantly optimising the build performance and it is wise to be using the latest version for the best performance. Here is how you change it<br>
In <code>&lt;Project Root&gt;/gradle/wrapper/</code><br>
Edit <code>gradle-wrapper.properties</code> and upgrade gradle <code>distributionUrl</code> to the <a href="http://gradle.org/gradle-download/">latest</a>.</p>

<blockquote>
<p>The difference will be substantially good if you are upgrading from or below <code>2.4</code></p>
</blockquote>

<h4>Use JDK 8</h4>

<p>Groovy, being a dynamic language, can really benifit from the <code>invoke dynamic</code> instruction in Java 7 and above. So using JDK7 or JDK8 will certainly be helpful.</p>

<ul>
<li>Download and install <a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">JDK 8</a></li>
<li><code>Cmd+Shift+A</code> or <code>Ctrl+Shift+A</code>, type <code>Project Structure</code> and change <code>JDK Location</code> to JDK 8 location</li>
</ul>

<h4>Parallel Execution</h4>

<p>If you have modules that are standalone, you can improve the build time a bit by enabling parallel execution.<br>
In your <code>./gradle/gradle.properties</code> or <code>&lt;Project Root&gt;/gradle.properties</code>, add this line</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span><a id="line-1" name="line-1"></a>org.gradle.parallel=true
</code></pre></div>
<h2>Common Pitfalls</h2>

<h4>Dynamic dependencies</h4>

<p>Use definite version numbers for your dependencies in your gradle</p>
<div class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span></span><a id="line-1" name="line-1"></a><span class="c1">//Do NOT do this</span>
<a id="line-2" name="line-2"></a><span class="n">compile</span> <span class="s1">&#39;com.google.code.gson:gson:2.+&#39;</span>
<a id="line-3" name="line-3"></a>
<a id="line-4" name="line-4"></a><span class="c1">//Do this instead</span>
<a id="line-5" name="line-5"></a><span class="n">compile</span> <span class="s1">&#39;com.google.code.gson:gson:2.3&#39;</span>
</code></pre></div>
<p>This avoids the problem of gradle always making a network request to check for the latest version of the dependency</p>

<h4>Avoid heavy computation</h4>

<p>You can find snippets like this on stack overflow that aim to make versioning easier for you</p>
<div class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span></span><a id="line-1" name="line-1"></a><span class="kt">def</span> <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;git rev-list HEAD --first-parent --count&#39;</span>
<a id="line-2" name="line-2"></a><span class="kt">def</span> <span class="n">gitVersion</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="na">execute</span><span class="o">().</span><span class="na">text</span><span class="o">.</span><span class="na">trim</span><span class="o">().</span><span class="na">toInteger</span><span class="o">()</span>
<a id="line-3" name="line-3"></a>
<a id="line-4" name="line-4"></a><span class="n">android</span> <span class="o">{</span>
<a id="line-5" name="line-5"></a>  <span class="n">defaultConfig</span> <span class="o">{</span>
<a id="line-6" name="line-6"></a>    <span class="n">versionCode</span> <span class="n">gitVersion</span>
<a id="line-7" name="line-7"></a>  <span class="o">}</span>
<a id="line-8" name="line-8"></a><span class="o">}</span>
</code></pre></div>
<p>The problem with this code is - gradle needs to count the number of commits for every build. For a large repo which has around <code>20000</code> commits, it takes around <strong>half a second</strong> to just count the number of commits.</p>

<h4>That&#39;s it</h4>

<p>After these optimisations your first build might take the same amount of time, but trust me your <strong>subsequent builds will be much faster</strong> overall. </p>

<p>Also there is one more very important optimisation you can do</p>

<h4>Get an SSD</h4>

<p>Please do.</p>

        </section>

        <hr />
    </article>

</main>

<aside class="read-next">

    <!-- [[! next_post ]] -->
    
        <a class="read-next-story no-cover" href="/dependency-management-in-multi-module-gradle-projects">
            <section class="post">
                <h2>Dependency management in multi-module gradle projects</h2>
                <time class="post-date" datetime="2017-11-02">02 Nov 2017</time>
            </section>
        </a>
    
    <!-- [[! /next_post ]] -->
    <!-- [[! prev_post ]] -->
    
        <a class="read-next-story prev no-cover" href="/RxConfusions-1-Map-and-FlatMap">
            <section class="post">
                <h2>RxConfusions - Part 1 : Map and FlatMap</h2>
                <time class="post-date" datetime="2015-12-02">02 Dec 2015</time>
            </section>
        </a>
    
    <!-- [[! /prev_post ]] -->
</aside>

<!-- /post -->


        <footer class="site-footer clearfix">
          <section class="copyright"><a href="/">@okmanideep</a> &copy; 2022</section>
          <section class="poweredby">Published with <a href="http://jekyllrb.com/">Jekyll</a></section>
        </footer>
    </div>
    <!-- Add Google Analytics  -->
        <!-- Google Analytics Tracking code -->
     <script>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', 'UA-57441445-3', 'auto');
	    ga('send', 'pageview');

     </script>   
</body>
</html>
